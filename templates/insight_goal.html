{% extends "base.html" %}
{% block title %}Investment Goal Setting - HyeonLee.net{% endblock %}

{% block content %}
<header class="masthead" style="background-image: url('{{ url_for('static', filename='assets/img/insight-bg.jpg') }}')">
  <div class="container px-4 px-lg-5">
    <div class="row justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="site-heading">
          <h1>Goal Setting</h1>
          <span class="subheading">
            가장 먼저 우리는 투자금액과 기간, 목표 등을 입력 후 모의계산을 통해 실현가능성을 직관적으로 이해합니다.
          </span>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="container my-5">

  <!-- 현재 단계 설명 -->
  <div class="text-center mb-4">
    <h5 class="fw-bold">📍 현재 단계: <span class="text-primary">1단계. 목표 설정</span></h5>
    <p class="text-muted small">투자금, 기간, 목표 등을 입력하여 실현 가능성을 계산합니다.</p>
  </div>

  <!-- 단계 카드형 내비게이션 -->
    <div class="d-flex justify-content-between mb-4 px-1 gap-2 overflow-auto" style="flex-wrap: nowrap;">
    {% set stages = [
        ("①", "목표 설정", True),
        ("②", "고수 원칙", False),
        ("③", "나의 원칙", False),
        ("④", "매수/매도전략", False),
        ("⑤", "지금 매수/매도?", False),
        ("⑥", "ML 예측", False)
    ] %}
    {% for icon, label, active in stages %}
    <div class="text-center border rounded p-2 {{ 'bg-dark text-white' if active else 'bg-light text-dark' }}"
        style="flex: 1 1 0%; min-width: 120px;">
        <div>{{ icon }}</div>
        <div class="fw-bold text-nowrap small">{{ label }}</div>
    </div>
    {% endfor %}
    </div>

  <!-- 입력 폼 -->
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <form method="POST" action="#result" class="bg-light p-4 rounded shadow-sm" onsubmit="setTimeout(() => window.scrollTo(0, document.body.scrollHeight), 100);">
        <h4 class="fw-bold mb-4 text-center">📌 투자 기초 정보 입력</h4>

        <div class="mb-3">
          <label for="principal" class="form-label">1️⃣ 현재 투자 원금 (만원)</label>
          <input type="number" class="form-control" id="principal" name="principal" placeholder="예: 1000" required>
        </div>

        <div class="mb-3">
          <label for="monthly" class="form-label">2️⃣ 매월 투자 금액 (만원)</label>
          <input type="number" class="form-control" id="monthly" name="monthly" placeholder="예: 50" required>
        </div>

        <div class="mb-3">
          <label for="years" class="form-label">3️⃣ 투자 기간 (년)</label>
          <input type="number" class="form-control" id="years" name="years" placeholder="예: 10" required>
        </div>

        <div class="mb-3">
          <label class="form-label">4️⃣ 목표 금액 또는 연평균 수익률 (%)</label>
          <div class="row">
            <div class="col">
              <input type="number" class="form-control" name="target_amount" placeholder="목표 금액 (만원)">
            </div>
            <div class="col">
              <input type="number" step="0.1" class="form-control" name="expected_return" placeholder="연평균 수익률 (%)">
            </div>
          </div>
          <small class="text-muted">둘 중 하나만 입력하면 됩니다.</small>
        </div>

        <div class="mb-3">
          <label for="purpose" class="form-label">5️⃣ 투자 목적</label>
          <select class="form-select" id="purpose" name="purpose">
            <option value="">선택해주세요</option>
            <option>은퇴 준비</option>
            <option>자녀 교육</option>
            <option>내 집 마련</option>
            <option>부자 되기</option>
            <option>기타</option>
          </select>
        </div>

        <div class="d-grid mt-4">
          <button type="submit" class="btn btn-dark btn-lg">모의 계산하기</button>
        </div>
      </form>

      {% if result %}
        <div id="result" class="card mt-4 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">📈 모의계산 결과</h5>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">📌 투자 원금: {{ "{:,}".format(result.principal | int) }} 만원</li>
            <li class="list-group-item">📌 목표 금액: {{ "{:,}".format(result.target_amount | int) }} 만원</li>
            <li class="list-group-item">📌 연평균 수익률: {{ result.expected_return }}%</li>
            <li class="list-group-item">📌 투자 기간: {{ result.years }}년</li>
            {% if result.purpose %}
            <li class="list-group-item">📌 투자 목적: {{ result.purpose }}</li>
            {% endif %}
            <li class="list-group-item">✅ 추천 개별 종목: {{ result.stock[0] }} (연 수익률 {{ result.stock[1] }}%)</li>
            <li class="list-group-item">✅ 추천 ETF: {{ result.etf[0] }} (연 수익률 {{ result.etf[1] }}%)</li>
          </ul>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
