{% extends "base.html" %}
{% block title %}Stock Overview - HyeonLee.net{% endblock %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
<style>
html { scroll-behavior: smooth; }
.sticky-progress { position: sticky; top: 0; z-index: 1000; background: #f8f9fa;
  padding: 0.5rem 0; border-bottom: 1px solid #dee2e6; margin-bottom: 1rem; }
.step-section { margin-bottom: 80px; }
.scroll-target { scroll-margin-top: 80px; }
.sector-btn {
  border: 1.5px solid #ddd; border-radius: 0.75rem; padding: 1rem 2rem;
  margin: 8px; background: #fff; cursor: pointer; font-weight: bold;
  transition: all 0.2s; font-size: 1.1rem;
}
.sector-btn.active, .sector-btn:hover {
  background: #f0f8ff; border-color: #007bff; color: #007bff;
  box-shadow: 0 0 7px rgba(0,123,255,0.15);
}
.stocks-row {
  display: flex; flex-wrap: wrap; gap: 18px; margin-top: 32px;
}
.stock-card {
  width: 120px; min-height: 90px; border: 1.5px solid #eee;
  border-radius: 12px; text-align: center; padding: 1rem 0.5rem;
  background: #fafcff; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  opacity: 0; transform: translateY(10px); transition: 0.5s;
  cursor: pointer;
}
.stock-card.show { opacity: 1; transform: none; }
.stock-card.selected {
  border: 2px solid #007bff;
  background: #e3f1ff;
  box-shadow: 0 0 0 2px #d0e8ff;
}
.stock-logo { width: 32px; height: 32px; margin-bottom: 6px; }
.stock-ticker { font-weight: bold; letter-spacing: 1px; }

.indicator-card {
  border: 1.5px solid #ddd; border-radius: 0.75rem; padding: 1.1rem 1rem 1rem 1rem;
  text-align: center; transition: all 0.2s; cursor: pointer;
  width: 110px; margin: 10px 13px 10px 0; font-size: 1.07rem;
  background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.03);
  display: inline-block; vertical-align: top;
}
.indicator-card.selected, .indicator-card:hover {
  background: #f5fbff;
  border-color: #007bff;
  color: #007bff;
  box-shadow: 0 0 10px rgba(0,123,255,0.09);
}
</style>

<header class="masthead" style="background-image: url('{{ url_for('static', filename='assets/img/stock-bg.jpg') }}')">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="site-heading">
          <h1>Stock</h1>
          <span class="subheading">일단 어디든 가보려는 페이지입니다. 가쯔앗!!!!!!</span>
        </div>
      </div>
    </div>
  </div>
</header>
<div class="sticky-progress">
  <div class="container px-4 px-lg-5">
    <div class="d-flex justify-content-between align-items-center">
      <div class="small">단계 진행 현황</div>
      <div class="small" id="progressText">0단계 완료</div>
    </div>
    <div class="progress">
      <div class="progress-bar bg-success" role="progressbar" id="progressBar" style="width: 0%"></div>
    </div>
  </div>
</div>
<main class="mb-5">
  <div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-lg-10">

        <!-- 1단계: 섹터/종목 선택 -->
        <section class="step-section scroll-target" id="step1">
          <h2 class="mb-3 step-title">1단계: 섹터/종목 선택</h2>
          <p class="text-muted">섹터를 선택하면 해당 대표 종목들이 로고와 함께 아래에 표시됩니다.<br>종목을 1개 이상 선택해 주세요.</p>
          <div id="sectorBtns" class="my-3">
            <button class="sector-btn" data-sector="기술주">기술주</button>
            <button class="sector-btn" data-sector="금융">금융</button>
            <button class="sector-btn" data-sector="헬스케어">헬스케어</button>
            <button class="sector-btn" data-sector="소비재">소비재</button>
            <button class="sector-btn" data-sector="에너지">에너지</button>
          </div>
          <div id="stocksContainer" class="stocks-row"></div>
          <div class="text-end mt-3">
            <button class="btn btn-outline-primary" id="step1CompleteBtn">선택완료</button>
          </div>
        </section>

        <!-- 2단계: 보조지표 선택 -->
        <section class="step-section scroll-target" id="step2">
          <h2 class="mb-3">2단계: 보조지표 선택</h2>
          <p class="text-muted">보조지표를 대분류(추세/거래량 등)로 구분해 선택하세요. (복수 선택 가능)</p>
          <h6 class="text-primary mt-4">📈 추세 기반</h6>
          <div class="d-flex flex-wrap justify-content-start" id="trendIndicators">
            <div class="indicator-card" data-id="MA"><i class="bi bi-graph-up"></i><br>MA</div>
            <div class="indicator-card" data-id="MACD"><i class="bi bi-bar-chart-line"></i><br>MACD</div>
            <div class="indicator-card" data-id="BB"><i class="bi bi-sliders"></i><br>볼린저밴드</div>
          </div>
          <h6 class="text-primary mt-4">📊 거래량 기반</h6>
          <div class="d-flex flex-wrap justify-content-start" id="volumeIndicators">
            <div class="indicator-card" data-id="OBV"><i class="bi bi-diagram-3"></i><br>OBV</div>
            <div class="indicator-card" data-id="VOL_MA"><i class="bi bi-reception-4"></i><br>거래량 이동평균</div>
          </div>
          <div class="text-end mt-3">
            <button class="btn btn-outline-primary" id="step2CompleteBtn">선택완료</button>
          </div>
        </section>
        <section class="step-section scroll-target" id="step3">
          <h2 class="mb-3">3단계: 시그널 요청 및 결과 확인</h2>
          <p class="text-muted">이제 선택한 종목과 지표를 기반으로 분석 결과를 확인할 수 있습니다.</p>
          <button class="btn btn-success" id="signalAnalyzeBtn">📊 시그널분석</button>
          <script>
          /* ...위의 코드 동일... */

          document.getElementById('signalAnalyzeBtn').addEventListener('click', function() {
            alert('🚧 시그널 분석 기능은 준비 중입니다!\n\nBackend 개발이 완료되면 이 버튼에서 결과를 받아볼 수 있습니다.');
          });

          /* ...나머지 스크립트 동일... */
          </script>
        </section>
      </div>
    </div>
  </div>
</main>
<script>
const sectorStocks = {
  "기술주": [
    { ticker: "AAPL", logo: "AAPL.png", name: "애플" },
    { ticker: "TSLA", logo: "TSLA.png", name: "테슬라" },
    { ticker: "NVDA", logo: "NVDA.png", name: "엔비디아" }
  ],
  "금융": [
    { ticker: "JPM", logo: "JPM.png", name: "JP모간" },
    { ticker: "GS",  logo: "GS.png",  name: "골드만삭스" },
    { ticker: "MS",  logo: "MS.png",  name: "모건스탠리" }
  ],
  "헬스케어": [
    { ticker: "PFE", logo: "PFE.png", name: "화이자" },
    { ticker: "JNJ", logo: "JNJ.png", name: "존슨앤존슨" },
    { ticker: "UNH", logo: "UNH.png", name: "유나이티드헬스" }
  ],
  "소비재": [
    { ticker: "PG", logo: "PG.png", name: "P&G" },
    { ticker: "KO", logo: "KO.png", name: "코카콜라" },
    { ticker: "PEP", logo: "PEP.png", name: "펩시" }
  ],
  "에너지": [
    { ticker: "XOM", logo: "XOM.png", name: "엑슨모빌" },
    { ticker: "CVX", logo: "CVX.png", name: "셰브런" },
    { ticker: "COP", logo: "COP.png", name: "코노코필립스" }
  ]
};

let selectedStocks = []; // 선택된 종목
let selectedIndicators = []; // 선택된 보조지표

// 섹터 버튼
document.querySelectorAll('.sector-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.sector-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    const sector = this.dataset.sector;
    showStocks(sector);
    selectedStocks = []; // 섹터 변경시 선택 초기화
  });
});

// 종목 카드 표시 및 선택
function showStocks(sector) {
  const stocks = sectorStocks[sector] || [];
  const cont = document.getElementById('stocksContainer');
  cont.innerHTML = '';
  stocks.forEach((s, i) => {
    const div = document.createElement('div');
    div.className = 'stock-card';
    setTimeout(() => div.classList.add('show'), 100 * i);
    div.innerHTML = `
      <img src="/static/assets/img/logos/${s.logo}" class="stock-logo" alt="${s.ticker}">
      <div class="stock-ticker">${s.ticker}</div>
      <div class="text-muted" style="font-size:13px">${s.name}</div>
    `;
    // 선택 토글
    div.addEventListener('click', () => {
      div.classList.toggle('selected');
      if(div.classList.contains('selected')) {
        selectedStocks.push(s.ticker);
      } else {
        selectedStocks = selectedStocks.filter(tk => tk !== s.ticker);
      }
    });
    cont.appendChild(div);
  });
}

// 보조지표 선택 토글
document.querySelectorAll('.indicator-card').forEach(card => {
  card.addEventListener('click', () => {
    card.classList.toggle('selected');
    const id = card.dataset.id;
    if(card.classList.contains('selected')) {
      if(!selectedIndicators.includes(id)) selectedIndicators.push(id);
    } else {
      selectedIndicators = selectedIndicators.filter(v => v !== id);
    }
  });
});

// 프로그래스바/카드 등 나머지 동작
document.getElementById('step1CompleteBtn').addEventListener('click', () => {
  updateProgressBar(1);
  scrollToStep(2);
});
document.getElementById('step2CompleteBtn').addEventListener('click', () => {
  updateProgressBar(2);
  scrollToStep(3);
});
function updateProgressBar(step) {
  const textMap = { 1: '1단계 완료', 2: '2단계 완료', 3: '3단계 완료' };
  const percent = step * 33;
  document.getElementById('progressBar').style.width = percent + '%';
  document.getElementById('progressText').innerText = textMap[step];
}
function scrollToStep(stepNum) {
  const target = document.getElementById(`step${stepNum}`);
  if (target) target.scrollIntoView({ behavior: 'smooth' });
}
</script>
{% endblock %}
