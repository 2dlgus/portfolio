{% extends "base.html" %}
{% block title %}Stock Overview - HyeonLee.net{% endblock %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
<style>
html { scroll-behavior: smooth; }
.sticky-progress { position: sticky; top: 0; z-index: 1000; background: #f8f9fa;
  padding: 0.5rem 0; border-bottom: 1px solid #dee2e6; margin-bottom: 1rem; }
.step-section { margin-bottom: 80px; }
.scroll-target { scroll-margin-top: 80px; }
.sector-btn {
  border: 1.5px solid #ddd; border-radius: 0.75rem; padding: 1rem 2rem;
  margin: 8px; background: #fff; cursor: pointer; font-weight: bold;
  transition: all 0.2s; font-size: 1.1rem;
}
.sector-btn.active, .sector-btn:hover {
  background: #f0f8ff; border-color: #007bff; color: #007bff;
  box-shadow: 0 0 7px rgba(0,123,255,0.15);
}
.stocks-row {
  display: flex; flex-wrap: wrap; gap: 18px; margin-top: 32px;
}
.stock-card {
  width: 120px; min-height: 90px; border: 1.5px solid #eee;
  border-radius: 12px; text-align: center; padding: 1rem 0.5rem;
  background: #fafcff; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  opacity: 0; transform: translateY(10px); transition: 0.5s;
  cursor: pointer;
}
.stock-card.show { opacity: 1; transform: none; }
.stock-card.selected {
  border: 2px solid #007bff;
  background: #e3f1ff;
  box-shadow: 0 0 0 2px #d0e8ff;
}
.stock-logo { width: 32px; height: 32px; margin-bottom: 6px; }
.stock-ticker { font-weight: bold; letter-spacing: 1px; }

.indicator-card {
  border: 1.5px solid #ddd; border-radius: 0.75rem; padding: 1.1rem 1rem 1rem 1rem;
  text-align: center; transition: all 0.2s; cursor: pointer;
  width: 110px; margin: 10px 13px 10px 0; font-size: 1.07rem;
  background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.03);
  display: inline-block; vertical-align: top;
}
.indicator-card.selected, .indicator-card:hover {
  background: #f5fbff;
  border-color: #007bff;
  color: #007bff;
  box-shadow: 0 0 10px rgba(0,123,255,0.09);
}
</style>

<header class="masthead" style="background-image: url('{{ url_for('static', filename='assets/img/stock-bg.jpg') }}')">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="site-heading">
          <h1>Stock</h1>
          <span class="subheading">ì¼ë‹¨ ì–´ë””ë“  ê°€ë³´ë ¤ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤. ê°€ì¯”ì•—!!!!!!</span>
        </div>
      </div>
    </div>
  </div>
</header>
<div class="sticky-progress">
  <div class="container px-4 px-lg-5">
    <div class="d-flex justify-content-between align-items-center">
      <div class="small">ë‹¨ê³„ ì§„í–‰ í˜„í™©</div>
      <div class="small" id="progressText">0ë‹¨ê³„ ì™„ë£Œ</div>
    </div>
    <div class="progress">
      <div class="progress-bar bg-success" role="progressbar" id="progressBar" style="width: 0%"></div>
    </div>
  </div>
</div>
<main class="mb-5">
  <div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-lg-10">

        <!-- 1ë‹¨ê³„: ì„¹í„°/ì¢…ëª© ì„ íƒ -->
        <section class="step-section scroll-target" id="step1">
          <h2 class="mb-3 step-title">1ë‹¨ê³„: ì„¹í„°/ì¢…ëª© ì„ íƒ</h2>
          <p class="text-muted">ì„¹í„°ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ëŒ€í‘œ ì¢…ëª©ë“¤ì´ ë¡œê³ ì™€ í•¨ê»˜ ì•„ë˜ì— í‘œì‹œë©ë‹ˆë‹¤.<br>ì¢…ëª©ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
          <div id="sectorBtns" class="my-3">
            <button class="sector-btn" data-sector="ê¸°ìˆ ì£¼">ê¸°ìˆ ì£¼</button>
            <button class="sector-btn" data-sector="ê¸ˆìœµ">ê¸ˆìœµ</button>
            <button class="sector-btn" data-sector="í—¬ìŠ¤ì¼€ì–´">í—¬ìŠ¤ì¼€ì–´</button>
            <button class="sector-btn" data-sector="ì†Œë¹„ì¬">ì†Œë¹„ì¬</button>
            <button class="sector-btn" data-sector="ì—ë„ˆì§€">ì—ë„ˆì§€</button>
          </div>
          <div id="stocksContainer" class="stocks-row"></div>
          <div class="text-end mt-3">
            <button class="btn btn-outline-primary" id="step1CompleteBtn">ì„ íƒì™„ë£Œ</button>
          </div>
        </section>

        <!-- 2ë‹¨ê³„: ë³´ì¡°ì§€í‘œ ì„ íƒ -->
        <section class="step-section scroll-target" id="step2">
          <h2 class="mb-3">2ë‹¨ê³„: ë³´ì¡°ì§€í‘œ ì„ íƒ</h2>
          <p class="text-muted">ë³´ì¡°ì§€í‘œë¥¼ ëŒ€ë¶„ë¥˜(ì¶”ì„¸/ê±°ë˜ëŸ‰ ë“±)ë¡œ êµ¬ë¶„í•´ ì„ íƒí•˜ì„¸ìš”. (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</p>
          <h6 class="text-primary mt-4">ğŸ“ˆ ì¶”ì„¸ ê¸°ë°˜</h6>
          <div class="d-flex flex-wrap justify-content-start" id="trendIndicators">
            <div class="indicator-card" data-id="MA"><i class="bi bi-graph-up"></i><br>MA</div>
            <div class="indicator-card" data-id="MACD"><i class="bi bi-bar-chart-line"></i><br>MACD</div>
            <div class="indicator-card" data-id="BB"><i class="bi bi-sliders"></i><br>ë³¼ë¦°ì €ë°´ë“œ</div>
          </div>
          <h6 class="text-primary mt-4">ğŸ“Š ê±°ë˜ëŸ‰ ê¸°ë°˜</h6>
          <div class="d-flex flex-wrap justify-content-start" id="volumeIndicators">
            <div class="indicator-card" data-id="OBV"><i class="bi bi-diagram-3"></i><br>OBV</div>
            <div class="indicator-card" data-id="VOL_MA"><i class="bi bi-reception-4"></i><br>ê±°ë˜ëŸ‰ ì´ë™í‰ê· </div>
          </div>
          <div class="text-end mt-3">
            <button class="btn btn-outline-primary" id="step2CompleteBtn">ì„ íƒì™„ë£Œ</button>
          </div>
        </section>
        <section class="step-section scroll-target" id="step3">
          <h2 class="mb-3">3ë‹¨ê³„: ì‹œê·¸ë„ ìš”ì²­ ë° ê²°ê³¼ í™•ì¸</h2>
          <p class="text-muted">ì´ì œ ì„ íƒí•œ ì¢…ëª©ê³¼ ì§€í‘œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <button class="btn btn-success" id="signalAnalyzeBtn">ğŸ“Š ì‹œê·¸ë„ë¶„ì„</button>
          <script>
          /* ...ìœ„ì˜ ì½”ë“œ ë™ì¼... */

          document.getElementById('signalAnalyzeBtn').addEventListener('click', function() {
            alert('ğŸš§ ì‹œê·¸ë„ ë¶„ì„ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤!\n\nBackend ê°œë°œì´ ì™„ë£Œë˜ë©´ ì´ ë²„íŠ¼ì—ì„œ ê²°ê³¼ë¥¼ ë°›ì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          });

          /* ...ë‚˜ë¨¸ì§€ ìŠ¤í¬ë¦½íŠ¸ ë™ì¼... */
          </script>
        </section>
      </div>
    </div>
  </div>
</main>
<script>
const sectorStocks = {
  "ê¸°ìˆ ì£¼": [
    { ticker: "AAPL", logo: "AAPL.png", name: "ì• í”Œ" },
    { ticker: "TSLA", logo: "TSLA.png", name: "í…ŒìŠ¬ë¼" },
    { ticker: "NVDA", logo: "NVDA.png", name: "ì—”ë¹„ë””ì•„" }
  ],
  "ê¸ˆìœµ": [
    { ticker: "JPM", logo: "JPM.png", name: "JPëª¨ê°„" },
    { ticker: "GS",  logo: "GS.png",  name: "ê³¨ë“œë§Œì‚­ìŠ¤" },
    { ticker: "MS",  logo: "MS.png",  name: "ëª¨ê±´ìŠ¤íƒ ë¦¬" }
  ],
  "í—¬ìŠ¤ì¼€ì–´": [
    { ticker: "PFE", logo: "PFE.png", name: "í™”ì´ì" },
    { ticker: "JNJ", logo: "JNJ.png", name: "ì¡´ìŠ¨ì•¤ì¡´ìŠ¨" },
    { ticker: "UNH", logo: "UNH.png", name: "ìœ ë‚˜ì´í‹°ë“œí—¬ìŠ¤" }
  ],
  "ì†Œë¹„ì¬": [
    { ticker: "PG", logo: "PG.png", name: "P&G" },
    { ticker: "KO", logo: "KO.png", name: "ì½”ì¹´ì½œë¼" },
    { ticker: "PEP", logo: "PEP.png", name: "í©ì‹œ" }
  ],
  "ì—ë„ˆì§€": [
    { ticker: "XOM", logo: "XOM.png", name: "ì—‘ìŠ¨ëª¨ë¹Œ" },
    { ticker: "CVX", logo: "CVX.png", name: "ì…°ë¸ŒëŸ°" },
    { ticker: "COP", logo: "COP.png", name: "ì½”ë…¸ì½”í•„ë¦½ìŠ¤" }
  ]
};

let selectedStocks = []; // ì„ íƒëœ ì¢…ëª©
let selectedIndicators = []; // ì„ íƒëœ ë³´ì¡°ì§€í‘œ

// ì„¹í„° ë²„íŠ¼
document.querySelectorAll('.sector-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.sector-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    const sector = this.dataset.sector;
    showStocks(sector);
    selectedStocks = []; // ì„¹í„° ë³€ê²½ì‹œ ì„ íƒ ì´ˆê¸°í™”
  });
});

// ì¢…ëª© ì¹´ë“œ í‘œì‹œ ë° ì„ íƒ
function showStocks(sector) {
  const stocks = sectorStocks[sector] || [];
  const cont = document.getElementById('stocksContainer');
  cont.innerHTML = '';
  stocks.forEach((s, i) => {
    const div = document.createElement('div');
    div.className = 'stock-card';
    setTimeout(() => div.classList.add('show'), 100 * i);
    div.innerHTML = `
      <img src="/static/assets/img/logos/${s.logo}" class="stock-logo" alt="${s.ticker}">
      <div class="stock-ticker">${s.ticker}</div>
      <div class="text-muted" style="font-size:13px">${s.name}</div>
    `;
    // ì„ íƒ í† ê¸€
    div.addEventListener('click', () => {
      div.classList.toggle('selected');
      if(div.classList.contains('selected')) {
        selectedStocks.push(s.ticker);
      } else {
        selectedStocks = selectedStocks.filter(tk => tk !== s.ticker);
      }
    });
    cont.appendChild(div);
  });
}

// ë³´ì¡°ì§€í‘œ ì„ íƒ í† ê¸€
document.querySelectorAll('.indicator-card').forEach(card => {
  card.addEventListener('click', () => {
    card.classList.toggle('selected');
    const id = card.dataset.id;
    if(card.classList.contains('selected')) {
      if(!selectedIndicators.includes(id)) selectedIndicators.push(id);
    } else {
      selectedIndicators = selectedIndicators.filter(v => v !== id);
    }
  });
});

// í”„ë¡œê·¸ë˜ìŠ¤ë°”/ì¹´ë“œ ë“± ë‚˜ë¨¸ì§€ ë™ì‘
document.getElementById('step1CompleteBtn').addEventListener('click', () => {
  updateProgressBar(1);
  scrollToStep(2);
});
document.getElementById('step2CompleteBtn').addEventListener('click', () => {
  updateProgressBar(2);
  scrollToStep(3);
});
function updateProgressBar(step) {
  const textMap = { 1: '1ë‹¨ê³„ ì™„ë£Œ', 2: '2ë‹¨ê³„ ì™„ë£Œ', 3: '3ë‹¨ê³„ ì™„ë£Œ' };
  const percent = step * 33;
  document.getElementById('progressBar').style.width = percent + '%';
  document.getElementById('progressText').innerText = textMap[step];
}
function scrollToStep(stepNum) {
  const target = document.getElementById(`step${stepNum}`);
  if (target) target.scrollIntoView({ behavior: 'smooth' });
}
</script>
{% endblock %}
